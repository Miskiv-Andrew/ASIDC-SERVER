# Guarder Server

## üìå –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 1.1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

**ServerCore ‚Äî —è–¥—Ä–æ HTTP/HTTPS —Å–µ—Ä–≤–µ—Ä–∞**  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö HTTP/HTTPS –∑–∞–ø—Ä–æ—Å–æ–≤, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏  
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [civetweb](https://github.com/civetweb/civetweb)  
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ HTTPS (HTTP –ø–æ—Ä—Ç –æ—Ç–∫–ª—é—á—ë–Ω)
  - HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è HTTPS
  - Security headers (XSS-Protection, Clickjacking protection)
  - Rate limiting –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

**DatabaseManager ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** [nanodbc](https://github.com/nanodbc/nanodbc), MySQL/PostgreSQL —á–µ—Ä–µ–∑ ODBC DSN  
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–º—å—é—Ç–µ–∫—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
  - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (IP/User-Agent –∏–∑–º–µ–Ω–µ–Ω–∏—è)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

**PasswordHasher ‚Äî –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–ª—è–º–∏**  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π  
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** OpenSSL PBKDF2-HMAC-SHA256  
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª–µ–π (8+ —Å–∏–º–≤–æ–ª–æ–≤, —Ä–µ–≥–∏—Å—Ç—Ä—ã, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
  - –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–ª–∞–±—ã—Ö –ø–∞—Ä–æ–ª–µ–π
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π

---

### 1.2. –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
–ö–ª–∏–µ–Ω—Ç (POSTMAN/–±—Ä–∞—É–∑–µ—Ä)
        ‚Üì
[ HTTPS ‚Üí Port 8443 ]
        ‚Üì
   ServerCore
        ‚Üì
   (–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
        ‚Üì
[–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí DatabaseManager]
        ‚Üì
[–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è ‚Üí PasswordHasher]
        ‚Üì
   [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞]
        ‚Üì
   [–û—Ç–≤–µ—Ç –≤ JSON]
```

---

### 1.3. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–Ø–∑—ã–∫:** C++17  
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
  - civetweb ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
  - nanodbc ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ ODBC
  - OpenSSL ‚Äî –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (PBKDF2, SHA256)
  - JSONCpp ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JSON
  - Qt ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è GUI (—Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –ª—é–±–∞—è —Å ODBC –¥—Ä–∞–π–≤–µ—Ä–æ–º (MySQL, PostgreSQL, SQL Server)  
- **DSN:** `GuarderDB`  
- **–ü—Ä–æ—Ç–æ–∫–æ–ª—ã:** HTTPS (TLS 1.2/1.3), REST API (POST + JSON)

---

### 1.4. –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
  - PBKDF2 —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–æ–ª—å—é
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤ (24 —á–∞—Å–∞)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ IP/User-Agent
  - SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
  - XSS –∑–∞—â–∏—Ç–∞ (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML –≤ JSON)

- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:**
  - Connection pool
  - –ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  - Graceful shutdown

- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
  - –û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä DatabaseManager
  - –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –º—å—é—Ç–µ–∫—Å—ã
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

---

### 1.5. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ servercore.cpp/h       # –Ø–¥—Ä–æ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ databasemanager.cpp/h  # –ú–µ–Ω–µ–¥–∂–µ—Ä –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ passwordhasher.cpp/h   # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ civetweb/              # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ ssl_certs/
‚îÇ   ‚îî‚îÄ‚îÄ server.pem             # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
‚îú‚îÄ‚îÄ gui/                       # –¢–µ—Å—Ç–æ–≤—ã–π GUI (Qt)
‚îî‚îÄ‚îÄ sql/
    ‚îî‚îÄ‚îÄ create_tables.sql      # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
```

---

### 1.6. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞

1. –ü–æ–ª—É—á–µ–Ω–∏–µ HTTPS –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ—Ä—Ç 8443  
2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: Bearer`  
3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ DatabaseManager  
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏  
6. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –æ—Ç–≤–µ—Ç–∞ —Å security –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏  
7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏  

---

### 1.7. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –¢–æ–ª—å–∫–æ HTTPS ‚Äî HTTP –æ—Ç–∫–ª—é—á—ë–Ω  
- Self-contained ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏  
- –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å ‚Äî Windows –∏ Linux  
- –õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å ‚Äî –æ–¥–∏–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª + —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç  
- –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äî DSN –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ä—è–¥–æ–º —Å .exe  

---

### 1.8. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

- **–§–æ—Ä–º–∞—Ç:** PEM  
- **–ò–º—è —Ñ–∞–π–ª–∞:** `server.pem`  
- **–†–∞–∑–º–µ—â–µ–Ω–∏–µ:** —Ä—è–¥–æ–º —Å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–æ–º –∏–ª–∏ –≤ `ssl_certs/`  
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:** –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω  

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OpenSSL (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

–î–ª—è —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è **PasswordHasher** —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π OpenSSL.

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenSSL
- –°–∫–∞—á–∞—Ç—å –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä: [Win32/Win64 OpenSSL](https://slproweb.com/products/Win32OpenSSL.html)  
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É—Ç—å:  
  ```
  C:\Program Files\OpenSSL-Win64
  ```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `OPENSSL_PATH`:

```powershell
setx OPENSSL_PATH "C:\Program Files\OpenSSL-Win64"
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ **–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Qt Creator** –∏–ª–∏ –∫–æ–Ω—Å–æ–ª—å.

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ (qmake)
–í `.pro` —Ñ–∞–π–ª–µ:

```qmake
win32 {
    OPENSSL_PATH = $$(OPENSSL_PATH)

    INCLUDEPATH += "$$OPENSSL_PATH/include"
    LIBS += -L"$$OPENSSL_PATH/lib/VC/x64/MD"
    LIBS += -llibssl -llibcrypto
}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
–î–æ–±–∞–≤—å—Ç–µ –≤ `.pro`:
```qmake
message("OPENSSL_PATH = $$OPENSSL_PATH")
```
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `qmake` –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –ø—É—Ç—å –∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º—É OpenSSL.
